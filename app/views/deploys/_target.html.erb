<%= content_tag :div, class: ["deploy-target", target.production? ? "bg-danger" : "bg-info"].compact do %>
  <h2 class="under"><%= target.name.upcase %></h2>

  <div class="last-deploy">
    <% deploy = target.last_successful_deploy_for(current_repo.name) %>
    <small class="muted">
      <strong>LAST DEPLOY:</strong>
      <% if deploy %>
        <%= print_email deploy.auth_user.email %> deployed
        <span class="text-info"><%= print_deploy_what(deploy) %></span>
        on <%= print_time deploy.created_at %>
      <% else %>
        <em>Nothing has been deployed on this target.</em>
      <% end %>
    </small>
    <% if deploy %>
      <br>
      <a href="<%= current_repo.diff_url(deploy, @prov_deploy) %>">
        <strong>What will Change?</strong>
        &nbsp;&nbsp;
        <span style="color:#000;">
          <%= print_deploy_what deploy %>
          &nbsp;
          &#x021D2;
          &nbsp;
          <%= print_deploy_what @prov_deploy %>
        </span>
      </a>
    <% end %>
  </div>
  <% if !target.user_can_deploy?(current_repo, current_user) %>
    <%= render partial: 'deploys/lock', locals: { target: target, lock: target.existing_lock(current_repo) } %>
  <% elsif active_deploy = target.active_deploy(current_repo) %>
    <div class="alert alert-info">
      <strong>Active</strong>:
      There is a deploy currently going out.
      <%= link_to repo_deploy_path(current_repo.name, active_deploy.id, watching: "1") do %>
        <i class="icon-eye-open"></i> Watch it here
      <%- end %>
    </div>
  <% else %>
    <%= link_to "Ship it Here", new_repo_deploy_path(current_repo.name, target_name: target.name, artifact_url: @prov_deploy.artifact_url, what: @prov_deploy.what, what_details: @prov_deploy.what_details), class: "btn btn-primary btn-success deploy-button shipithere", data: {"target" => target.name} %>
    <br><br>
  <% end %>
<%- end %>
