<h1>
  <%= content_tag :i, "", class: "icon-#{current_project.icon}" %>
  <%= current_project.titleized_name %>
</h1>

<h2 class="steps-count" style="border-bottom: none;">Step 1 of 3</h2>

<div>
  <%= render partial: "application/deploy_what_tabs" %>
  <div class="row" style="margin-bottom: 10px">
    <div class="col-md-2 col-md-offset-6" style="font-size: 1.5em;">
      Status Checks
    </div>
  </div>
  <div class="row">
    <div class="well well-sm col-md-3" style="margin-left: 15px; margin-right: -15px;">
      <%= form_tag request.path, method: "get", class: "form form-inline", id: "allow-pending-builds-form" do |f| %>
        <%= check_box_tag :allow_pending_builds, "1", @allow_pending_builds %>
        <%= label_tag :allow_pending_builds, "Allow deployment of pending builds?" %>
      <%- end %>
    </div>
    <div class="col-md-1 col-md-offset-1">
      <label>Compliance</label>
    </div>
    <div class="col-md-1">
      <label>Primary Build</label>
    </div>
    <% current_project.extra_status_contexts.values.each_with_index do |test_name, i| %>
      <div class="col-md-1"><label><%= test_name %></label></div>
    <% end %>
  </div>

  <%- if @builds.empty? %>
    <p>
      <strong>Sorry, there are no recent builds for this branch.</strong>
    </p>
  <%- else %>
    <ul class="list-unstyled deploy-list">
      <% @builds.each do |build| %>
        <li>
          <div class="row">
            <div class="col-md-3">
              <h4>
                <%- deployability = build.deployability(allow_pending_builds: @allow_pending_builds) %>
                <%= link_to "Ship This", select_target_project_deploys_path(current_project, artifact_url: build.artifact_url), class: "btn #{shipit_btn_class(build)} btn-xs deploy-button", disabled: !deployability.permitted?, title: deployability.reason %>
                &nbsp;
                <%= deploy_type_icon("build") %> build<%= build.build_number %>
              </h4>
              <small class="muted">
                commit:
                <%= link_to current_project.sha_url(build.sha), title: build.sha do %>
                  <%= sha_span(build.sha)  %>
                <%- end %>
              </small>
            </div>
            <div class="col-md-1 col-md-offset-1">
              <%= render partial: "streetlight", locals: { state: build.state_for_context(GithubRepository::COMPLIANCE_STATUS), build_url: build.url_for_context(GithubRepository::COMPLIANCE_STATUS) } %>
            </div>
            <div class="col-md-1">
              <%= render partial: "streetlight", locals: { state: build.passed_ci? ? GithubRepository::SUCCESS : GithubRepository::FAILURE, build_url: build.url } %>
            </div>
            <% current_project.extra_status_contexts.keys.each_with_index do |test, i| %>
              <div class="col-md-1">
                <%= render partial: "streetlight", locals: { state: build.state_for_context(test), build_url: build.url_for_context(test) } %>
              </div>
            <%- end %>
          </div>
          <hr>
        </li>
      <% end %>
    </ul>
  <%- end %>
</div>

<%= pagination_links(@builds.length, @total_builds) %>
