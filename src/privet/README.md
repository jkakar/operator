# Privet

Privet is a tool to parallelize a test suite. Given a list of tests to run—and optionally, information about a previous test run—it will create a plan to execute those tests on an arbitrary number of workers.

Privet has two main subcommands: plan and execute. The plan command produces a JSON file that describes tests to be run, split up into chunks by worker. The execute command ingests a plan JSON file and executes test chunks for a given worker.

It might be easier to understand with a hypothetical example:

To create a plan, Privet requires a list of test files to be run. This list can be generated by whatever is appropriate for your setup. This test manifest is a file with a list of test files, one per line. For instance:

```
/path/to/test1.php
/path/to/test2.php
/path/to/test3.php
```

With this test manifest, Privet can generate a plan:

```
privet \
  -test-files-file="/path/to/test/files/file.txt" \
  -num-workers="15" \
  -target-duration="30s"
  plan
```

Optionally, a directory containing results from a previous build can be specified using the `-previous-results-dir` option. If present, Privet will use timing information from the previous results to split the tests in more evenly timed chunks. Right now, only JUnit formatted results are supported, but support for other formats could be added.

The plan is generally uploaded to some shared location (for Pardot, the pd-build-plans repository on https://artifactory.dev.pardot.com) and downloaded by each test worker. Given the plan, each worker uses Privet to execute the plan:

```
privet \
  -plan-file="/path/to/plan/file.json" \
  -worker="0" \
  -parallelism="4" \
  -command-path="/path/to/command/that/runs/tests"
```

The command given in `command-path` will be executed for each test chunk. The tests that should be run will be streamed into the command's standard input in the format:

```json
{
  "test_executions": [
    {
      "filename": "/path/to/test1.php"
    },
    {
      "filename": "/path/to/test2.php"
    }
  ]
}
```

The `command-path` command is responsible for running those tests (and only those tests!) and making the results available to the CI system.
