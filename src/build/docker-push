#!/usr/bin/env bash
#/ Usage: docker-push <image> <ecr-repo>
#/ Push a built Docker image to EC2 Container Service.
set -euo pipefail

awscredentials="/etc/aws/credentials"
if ! test -f "$awscredentials"
then
  echo "$awscredentials file is missing." 2>&1
  exit 1
fi

mkdir -p ~/.aws
cp /etc/aws/credentials ~/.aws/credentials
eval "$(aws ecr get-login)"

# shellcheck disable=SC2154
image="${1}:${bamboo_buildNumber}"
docker tag "$1" "$image"
docker push "$image"
