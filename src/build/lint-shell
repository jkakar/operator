#!/usr/bin/env bash
set -eu

failures=

git ls-files |
grep -v src/build/vendor |
grep -v src/github.com/hashicorp/terraform |
while read f; do
    if file "$f" | grep -q -E "bash script|POSIX shell"; then
        if ! shellcheck -f gcc "$f"; then
            failures="$failures $f"
        fi
    fi
done

if [ -z "$failures" ]; then
    exit 1
fi

true
